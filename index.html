<html lang="fr">
<head>
	<meta http-equiv="Content-Type" content="text/html" />
    <title>Tag Alpha</title>
    <link rel="stylesheet" href="bootstrap.min.css">
	<script type="text/javascript" src="jquery-2.0.2.min.js"></script>	
	<script type="text/javascript" src="jquery.mobile-1.4.0-rc.1.min.js"></script>	
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3&sensor=true"></script>
	<script language="Javascript">
		// Init position
		var myLocation;
		var map;
		var pos;
		
		// Init google maps
		google.maps.event.addDomListener(window, 'load', setup);
		function setup() {
			// wait for PhoneGap to load
			document.addEventListener("deviceready", onDeviceReady, false);
        
			function onDeviceReady() {
				// get device's geographical location and return it as a Position object (which is then passed to onSuccess)
				navigator.geolocation.getCurrentPosition(onSuccess, onError);
			}
		}
		
		// Function success maps load
		function onSuccess(position) { 
			pos = position;
			myLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			map  = new google.maps.Map(document.getElementById('map_canvas'), {
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				center: myLocation,
				zoom: 15
			}); 
		}
		
		// Function error maps load
		function onError(){console.log("Load of google maps api failed.");}
	</script>

</head>
  
<body>
<div id="content">
	<div id="general" class="row-fluid">
		<div class="text-center span12">
			<form id="form_send">
				<legend>Send a message</legend>                 
				<textarea id="form_message" name="form_message">your message</textarea>
				<BR>
				<input id="form_send_button" type="submit" value="Send" class="btn btn-primary">
			</form>
			<div id="result"></div>
			<div>Latitude: <span id="lat"></span><BR>Longitude: <span id="lng"></span></div>
			<div id="map_canvas" style="width: 100%;height:600px;"></div>
		</div>
	</div>
</div>

<SCRIPT language="Javascript">
// Set variables
/*var latitude ;
var longitude ;
var map;

// Get position
navigator.geolocation.getCurrentPosition (function (pos)
{
	latitude = pos.coords.latitude;
	longitude = pos.coords.longitude;
});

// Display position
function Display_position(){
	$("#lat").text(latitude);
	$("#lng").text(longitude);
	
	if(latitude==undefined){setTimeout(function(){Display_position();}, 500);}
	if(latitude!=undefined){setTimeout(function(){map.setCenter(new google.maps.LatLng( latitude, longitude ));}

}*/

// Function send message
function Send_message(){	
	// definition of ajax data
	var L_file_ajax = "http://www.net-brothers.com/tag/ajax/send_message.php";
	var L_data = {};
	L_data['message']= $('#form_message').val();
	L_data['latitude']= pos.latitude;
	L_data['longitude']= pos.longitude;
	L_data['accuracy']= pos.accuracy;
	
	// ajax request
	var jqxhr = $	.ajax({type:"GET",url:L_file_ajax,data:L_data})
					.done(function(IN_result){$('#result').text("Message sent successfully!");})
					.fail(function(){$('#result').text("Message sending failed !");})
}

// Function maps
/*function Maps(){
	console.log(latitude);
	var myLatlng = new google.maps.LatLng(43.64,1.45);
    var myOptions = {
            center: myLatlng,
            zoom: 15,
            mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map_element = document.getElementById("map_canvas");
    map = new google.maps.Map(map_element, myOptions);	
}
MyMap.map.setCenter(new google.maps.LatLng( 45, 19 ) );
    //watchID = navigator.geolocation.getCurrentPosition(win, fail);
*/


// Main

// Position
//Display_position();

// Detect form submit
$('#form_send').submit(function(e){
			e.preventDefault(); // de-activate hmtl action of the form
			Send_message(); // launch cusutom submit action
		})
		
// Display maps
//Maps();

</SCRIPT>
</body>
</html>			
